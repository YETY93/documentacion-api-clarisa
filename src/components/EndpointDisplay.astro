---
// src/components/EndpointDisplay.astro
const { method, endpoint_prod, endpoint_qa } = Astro.props;

const hasProd = !!endpoint_prod;
const hasQA = !!endpoint_qa;

const methodColors = {
  GET: 'bg-blue-500 dark:bg-blue-600',
  POST: 'bg-green-500 dark:bg-green-600',
  PUT: 'bg-yellow-500 dark:bg-yellow-600',
  DELETE: 'bg-red-500 dark:bg-red-600',
  PATCH: 'bg-purple-500 dark:bg-purple-600'
};

const methodColor = methodColors[method] || 'bg-gray-500 dark:bg-gray-600';
---

<div class="endpoint-container">
  <div class="px-3 py-2 bg-slate-50 dark:bg-slate-800/30 border-b border-slate-200 dark:border-slate-700">
    <span class="text-xs font-medium text-slate-600 dark:text-slate-400">Endpoint</span>
  </div>

  {(hasProd && hasQA) && (
    <div class="flex border-b border-slate-200 dark:border-slate-700">
      <button data-endpoint="prod" class="endpoint-tab active">
        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        Producci√≥n
      </button>
      <button data-endpoint="qa" class="endpoint-tab">
        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
        </svg>
        QA
      </button>
    </div>
  )}

  <div class="p-3">
    {hasProd && (
      <div id="prod-content" class="endpoint-content">
        <div class="flex items-start gap-2">
          <span class={`method-badge ${methodColor}`}>{method}</span>
          <code class="endpoint-url">{endpoint_prod}</code>
        </div>
      </div>
    )}
    {hasQA && (
      <div id="qa-content" class:list={["endpoint-content", { hidden: hasProd && hasQA }]}>
        <div class="flex items-start gap-2">
          <span class={`method-badge ${methodColor}`}>{method}</span>
          <code class="endpoint-url">{endpoint_qa}</code>
        </div>
      </div>
    )}
  </div>
</div>

<script>
  function initEndpointTabs() {
    const containers = document.querySelectorAll('.endpoint-container');
    
    containers.forEach(container => {
      const tabs = container.querySelectorAll('.endpoint-tab');
      if (tabs.length === 0) return;

      function switchTab(targetEndpoint) {
        const currentTabs = container.querySelectorAll('.endpoint-tab');
        const contents = container.querySelectorAll('.endpoint-content');

        currentTabs.forEach(tab => tab.classList.remove('active'));
        const activeTab = container.querySelector(`[data-endpoint="${targetEndpoint}"]`);
        if (activeTab) activeTab.classList.add('active');

        contents.forEach(content => content.classList.add('hidden'));
        const activeContent = container.querySelector(`#${targetEndpoint}-content`);
        if (activeContent) activeContent.classList.remove('hidden');
      }

      tabs.forEach(tab => {
        tab.addEventListener('click', () => switchTab(tab.dataset.endpoint));
      });
    });
  }

  document.addEventListener('astro:page-load', initEndpointTabs);
  initEndpointTabs();
</script>

<style>
  .endpoint-container {
    @apply bg-white dark:bg-slate-900/50 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden;
  }

  .endpoint-tab {
    @apply flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors;
  }

  .endpoint-tab.active {
    @apply bg-clarisa-50 dark:bg-clarisa-900/20 text-clarisa-600 dark:text-clarisa-400 font-semibold;
  }

  .method-badge {
    @apply flex-shrink-0 text-white text-sm font-bold uppercase px-2 py-1 rounded min-w-[4rem] text-center;
  }

  .endpoint-url {
    @apply text-sm text-slate-700 dark:text-slate-300 break-all leading-relaxed;
  }
</style>