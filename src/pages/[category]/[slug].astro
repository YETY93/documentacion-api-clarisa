---
// src/pages/[category]/[slug].astro
import MainLayout from '../../layouts/MainLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import UniversalMarkdownProcessor from '../../components/UniversalMarkdownProcessor.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const pages = await getCollection('docs');
  return pages.map((page) => {
    const params = { category: page.data.category, slug: page.slug.split('/').pop() };
    const props = { page };
    return { params, props };
  });
}

const { page } = Astro.props;
const { Content } = await page.render();

// Obtener el contenido raw del markdown para procesarlo
const rawContent = page.body;
---
<MainLayout 
  title={page.data.title}
  method={page.data.method}
  endpoint_prod={page.data.endpoint_prod}
  endpoint_qa={page.data.endpoint_qa}
  response_code={page.data.response_code}
  response_success={page.data.response_success}
  response_code_error={page.data.response_code_error}
  response_error={page.data.response_error}
>
  <!-- Breadcrumbs -->
  <Breadcrumbs category={page.data.category} title={page.data.title} />
  
  <!-- Contenido del documento -->
  <div class="prose prose-slate dark:prose-invert max-w-none">
    <!-- Header del documento -->
    <div class="not-prose mb-8 pb-6 border-b border-gray-200 dark:border-slate-700">
      <div class="flex items-center space-x-3 mb-4">
        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-clarisa-100 text-clarisa-800 dark:bg-clarisa-900/30 dark:text-clarisa-300">
          {page.data.category}
        </span>
      </div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-3">
        {page.data.title}
      </h1>
      {page.data.description && (
        <p class="text-lg text-gray-600 dark:text-gray-300">
          {page.data.description}
        </p>
      )}
    </div>
    
    {/* El procesador ahora recibe los datos del endpoint para pasarlos a los componentes hijos */}
    <UniversalMarkdownProcessor 
      content={rawContent}
      method={page.data.method}
      endpoint_prod={page.data.endpoint_prod}
      endpoint_qa={page.data.endpoint_qa}
    />
  </div>
</MainLayout>
