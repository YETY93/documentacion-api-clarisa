---
// src/layouts/MainLayout.astro
import Header from "../components/Header.astro";
import SidebarMenu from "../components/SidebarMenu.astro";
import CodePanel from "../components/CodePanel.astro";
import "../styles/global.css";

const { title } = Astro.props;
---

<!-- Estilos para prevenir FOUC -->
<style is:inline>
  /* Prevenir el parpadeo del tema */
  html {
    color-scheme: light;
  }

  html.dark {
    color-scheme: dark;
  }

  /* Transición suave para el cambio de tema */
  * {
    transition:
      background-color 0.3s ease,
      color 0.3s ease,
      border-color 0.3s ease;
  }
</style>

<html lang="es" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>

    <!-- Script para aplicar el tema ANTES de renderizar -->
    <script is:inline>
      // Aplicar el tema guardado inmediatamente para prevenir FOUC
      (function () {
        const theme = localStorage.getItem("theme") || "light";
        if (theme === "dark") {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
  </head>
  <body
    class="h-full bg-gray-50 dark:bg-gray-900 text-slate-900 dark:text-slate-100 transition-colors"
  >
    <!-- Header fijo -->
    <header
      class="bg-slate-900 dark:bg-slate-800 text-white shadow-lg sticky top-0 z-50 border-b border-slate-700"
    >
      <div class="h-16 flex items-center">
        <Header />
      </div>
    </header>

    <!-- Contenedor principal con diseño de 3 columnas -->
    <div class="flex h-[calc(100vh-64px)] max-w-screen-2xl mx-auto">
      <!-- Columna Izquierda: Menú de navegación -->
      <aside
        class="w-80 bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 overflow-hidden flex flex-col"
      >
        <div class="p-6 overflow-y-auto flex-1">
          <SidebarMenu />
        </div>
      </aside>

      <!-- Columna Central: Contenido principal -->
      <main class="flex-1 bg-white dark:bg-slate-800 overflow-y-auto">
        <div class="p-8 max-w-4xl">
          <slot />
          <!-- Aquí se inyectará el contenido de cada página -->
        </div>
      </main>

      <!-- Columna Derecha: Panel de código -->
      <aside
        class="w-96 bg-gray-50 dark:bg-gray-900 border-l border-gray-200 dark:border-gray-700 overflow-hidden flex flex-col"
      >
        <div class="p-6 overflow-y-auto flex-1">
          <CodePanel />
        </div>
      </aside>
    </div>

    <!-- Responsive: Menú móvil -->
    <div id="mobile-menu" class="lg:hidden fixed inset-0 z-40 hidden">
      <div class="fixed inset-0 bg-black bg-opacity-50" id="mobile-overlay">
      </div>
      <div
        class="fixed left-0 top-16 bottom-0 w-80 bg-white dark:bg-slate-800 shadow-xl transform -translate-x-full transition-transform"
        id="mobile-sidebar"
      >
        <div class="p-6 overflow-y-auto h-full">
          <SidebarMenu />
        </div>
      </div>
    </div>

    <!-- Botón de menú móvil -->
    <button
      id="mobile-menu-button"
      class="lg:hidden fixed bottom-6 left-6 z-50 bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-colors"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>

    <script>
      // Funcionalidad del menú móvil
      document.addEventListener("DOMContentLoaded", function () {
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenu = document.getElementById("mobile-menu");
        const mobileSidebar = document.getElementById("mobile-sidebar");
        const mobileOverlay = document.getElementById("mobile-overlay");

        function toggleMobileMenu() {
          mobileMenu?.classList.toggle("hidden");
          mobileSidebar?.classList.toggle("-translate-x-full");
        }

        mobileMenuButton?.addEventListener("click", toggleMobileMenu);
        mobileOverlay?.addEventListener("click", toggleMobileMenu);

        // Cerrar menú al cambiar de tamaño de pantalla
        window.addEventListener("resize", function () {
          if (window.innerWidth >= 1024) {
            mobileMenu?.classList.add("hidden");
            mobileSidebar?.classList.add("-translate-x-full");
          }
        });
      });
    </script>
  </body>
</html>
